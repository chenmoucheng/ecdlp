%
% Index calculus for ECDLP
%

\section{Previous works}
\subsection{Index calculus for ECDLP}
%
\label{sec:index-calculus-ecdlp}
%
Let $E$ be an elliptic curve defined over a finite field \F{p^n}.
%
For cryptographic applications, we are mostly interested in a
prime-order subgroup generated by a rational point $P\in E(\F{p^n})$.
%
Here we first give a high-level overview of a typical index calculus
algorithm for finding an integer $\alpha$ such that $Q=\alpha P$ for
$Q\in\langle P\rangle$.
%
\begin{enumerate}
%
\item Determine a \emph{factor base} $\mathcal F\subset E(\F{p^n})$.
%
\item Collect a set $\mathcal R$ of \emph{relations} by decomposing
  random points $a_iP+b_iQ$ into a sum of points from $\mathcal F$,
  i.e.,
  \[ \mathcal
    R=\left\{a_iP+b_iQ=\sum_{j=1}^mP_{i,j}:P_{i,j}\in\mathcal
      F\right\}. \]
%
\item When $|\mathcal R|\approx|\mathcal F|$, eliminate the righthand
  side using linear algebra to obtain an equation in the form
  $aP+bQ=\mathcal O$, and $\alpha=-a/b\bmod\ord(P)$.
%
\end{enumerate}
%
The last step of linear algebra is relatively well studied in the
literature, so we will focus on the subproblem in the 2nd step,
namely, the point decomposition problem (PDP) on an elliptic curve in
the rest of this paper.
%
\subsubsection{Point Decomposition Problem(PDP).}
  Given a point $R$ in an elliptic curve $E(\F{p^n})$ and a 
  factor base $\mathcal F$, find, if they exist, 
  $P_1, \dots, P_n$ in $\mathcal F$, such that
  \begin{align*}
    R=P_1 + \cdots + P_n.
  \end{align*}



\subsection{Semaev's summation polynomials}
%
\label{sec:summation-polynomial}
%
We can solve PDP by considering when a set of points sum to zero on
the elliptic curve.
%
It is straightforward that if two points sum to zero on a Weierstrass
curve, then their $x$-coordinates must be equal.
%
Let us now consider the simplest yet nontrivial case where three
points on a Weierstrass curve $y^2=x^3+ax+b$ sum to zero.
%
Let
\[ Z=\left\{\begin{aligned}
      (x_1,y_1,x_2,y_2,x_3,y_3)&\in\F{p^n}^6:(x_i,y_i)\in E(\F{p^n}),i=1,2,3; \\
      & (x_1,y_1)+(x_2,y_2)+(x_3,y_3)=\mathcal O
    \end{aligned} \right\}. \]
%
Clearly, $Z$ is in the variety of the ideal
$I\subset\F{p^n}[X_1,Y_1,X_2,Y_2,X_3,Y_3]$ generated by
\[ \left\{\begin{aligned}
      & Y_i^2 - (X_i^3 + aX_i + b),i=1,2,3; \\
      &  (X_3 - X_1)(Y_2 - Y_1) - (X_2 - X_1)(Y_3 - Y_1)\\
    \end{aligned}\right\}. \]
%
Now let $J=I\cap\F{p^n}[X_1,X_2,X_3]$.
%
Using MAGMA's \texttt{EliminationIdeal} function, we obtain that $J$
is actually a principal ideal generated by the polynomial
$(X_2 - X_3)(X_1 - X_3)(X_1 - X_2)f_3$, where
%
\begin{align*}
  f_3 = & X_1^2X_2^2 - 2X_1^2X_2X_3 + X_1^2X_3^2 - 2X_1X_2^2X_3 - 2X_1X_2X_3^2 - 2aX_1X_2 - 2aX_1X_3 \\
        & - 4bX_1 + X_2^2X_3^2 - 2aX_2X_3 - 4bX_2 - 4bX_3 + a^2.
\end{align*}
%
Clearly, the linear factors of this generator correspond to the
degenerated case where two or more points are the same or of opposite
signs, and $f_3$ is the 3rd \emph{summation polynomial}, that is, the
summation polynomial for three distinct points summing to zero.

Starting from the 3rd summation polynomial, one can recursively obtain
the subsequent summation polynomials $f_m$ for $m>3$ via taking
resultants.
%
As a result, the degree of each variable in the $m$-th summation
polynomial grows exponentially as $m$, i.e., $2^{m-2}$.
%
This is the observation Semaev made in his seminal
work~\cite{DBLP:journals/iacr/Semaev04}.
%
In short, his proposal is to consider factor bases of the following
form:
\[ \mathcal F=\Big\{(x,y)\in E(\F{p^n}):x\in
  V\subset\F{p^n})\Big\}, \] where $V$ is a subset of \F{p^n}.
%
Let PDP of $m$-th order be the problem of decomposing a point
$(x,y)\in E(\F{p^n})$ into $m$ points from a factor base.
%
Then one way to solve it is via solving the corresponding $(m+1)$-th
summation polynomial $f_{m+1}(X_1,\ldots,X_m,x)=0$.

Note that this factor base is naturally invariant under negation.
%
That is, $P_i\in\mathcal F$ implies $-P_i\in\mathcal F$.
%
In this case, we will have about $|\mathcal F|/2$ (trivial) relations
$P_i+(-P_i)=\mathcal O$ for free, so we just need to find about
$|\mathcal F|/2$ nontrivial relations.
%
In general, we will only discuss factor bases that are invariant under
negation, so by abuse of language, both $\mathcal F$ and $\mathcal F$
modulo negation may be referred to as a factor base in the rest of
this paper.

\subsection{Weil restriction}
\label{sec:weil-restriction}
%
Restricting $x$-coordinates of the points in factor base to a subset
of \F{p^n} is important from a viewpoint of polynomial system solving.
%
Take $f_3$ as an example.
%
When decomposing a random point $aP+bQ$, we first substitute its
$x$-coordinate into say $X_3$, projecting $J$ onto $\F{p^n}[X_1,X_2]$.
%
The dimension of the variety of this ideal is nonzero.
%
Therefore, we would like to pose some restrictions on $X_1$ and $X_2$
to reduce the dimension to zero and make the solving time more
manageable.

When looking for solutions to a polynomial in $\F{p^n}[X]$ in \F{p^n},
we can view it as a commutative affine algebra
$\mathcal A=\F{p^n}[X]/(X^{p^n} -
X)\cong\F{p^n}[X_1,\ldots,X_n]/(X_1^p - X_1,\ldots,X_n^p - X_n)$.
%
This can be done by identifying the indeterminate $X$ as
$X_1\theta_1+\cdots+X_n\theta_n$, where $(\theta_1,\ldots,\theta_n)$
is a basis for \F{p^n} over \F p.
%
Hence, a polynomial $f=\sum a_iX^i\in\F{p^n}[X]$ can be identified as
a polynomial $f_1\theta_1+\cdots+f_n\theta_n$, where
$f_1,\ldots,f_n\in\mathcal A'=\F p[X_1,\ldots,X_n]/(X_1^p -
X_1,\ldots,X_n^p - X_n)$, by appropriately sending any coefficient
$a_i\in\F{p^n}$ to $a_i^{(1)}\theta_1+\cdots+a_i^{(n)}\theta_n$ for
$a_i^{(1)},\ldots,a_i^{(n)}\in\F p$.
%
Therefore, an equation $f=0$ over \F{p^n} will give rise to a system
of equations $f_1=\cdots=f_n=0$ over \F p.
%
This technique is known as the \emph{Weil restriction} and is used in
the Gaudry-Diem attack, in which the factor base is chosen to consist
of points whose $x$-coordinates lie in a subspace $V$ of \F{p^n} over
\F p~\cite{DBLP:journals/jsc/Gaudry09,DBLP:journals/moc/Diem11}.

\subsection{Exploiting symmetry}
%
\label{sec:exploit-symmetry}
%
Naturally, the symmetric group $S_m$ acts on a point decomposition
$P_1+\ldots+P_m$ because elliptic curve groups are abelian.
%
As noted by Gaudry in his seminal
work~\cite{DBLP:journals/jsc/Gaudry09}, we can therefore rewrite the
variables $x_1,\ldots,x_m\in\F{p^n}$ by elementary symmetric
polynomials $e_1,\ldots,e_m$, where $e_1=\sum x_i$,
$e_2=\sum_{i\neq j}x_ix_j$,
$e_3=\sum_{i\neq j,i\neq k,j\neq k}x_ix_jx_k$, etc.
%
Such rewriting can reduce the degree of summation polynomials and
significantly speed up point
decomposition~\cite{DBLP:conf/eurocrypt/FaugerePPR12,DBLP:conf/iwsec/HuangPST13}.

One might be able to exploit additional symmetry using actions of
other groups, e.g., when the factor base is invariant under addition
of small torsion points~\cite{DBLP:journals/joc/FaugereGHR14}.
%
For example, consider a relation $R$ under the action of addition of a
2-torsion point $T_2$:
\begin{align*}
  R & = P_1+\cdots+P_n \\
    & =
      (P_1+u_1T_2)+\cdots+(P_{n-1}+u_{n-1}T_2)+\left(P_n+\left(\sum_{i=1}^{n-1}u_i\right)T_2\right).
\end{align*}
%
Clearly this holds for any $u_1,\ldots,u_{n-1}\in\{0,1\}$, and
$P_i\in\mathcal F$ implies that $P_i+u_iT_2\in\mathcal F$ when the
factor base $\mathcal F$ is invariant under addition of $T_2$.

Naturally, such kind of speed-up is curve-specific.
%
Furthermore, even if the factor base is invariant under addition of
small torsion points, we may or may not be able to exploit such
symmetry to speed up point decomposition depending on whether the
action of addition of these small torsion points is ``easy to handle
in the polynomial system solving
process''~\cite{DBLP:journals/joc/FaugereGHR14}.


%------------------------------
\subsection{(Twisted) Edwards curves}
%------------------------------------
\label{sec:twisted-edwards}


Faug\`ere, Gaudry, Hout, and Renault studied PDP on twisted Edwards,
twisted Jacobi intersections, and Weierstrass
curves~\cite{DBLP:journals/joc/FaugereGHR14}.
%
We include some basic facts about (twisted) Edwards curves here.
%
%
An Edwards curve over \F{p^n} for $p\neq 2$ is defined by the
equation \begin{equation*}
  x^2+y^2=1+dx^2y^2 \label{eq:edwards-curve} \end{equation*} for
$d\in\F{p^n}$~\cite{DBLP:journals/iacr/BernsteinL07}.
%
A twisted Edwards curve $tE_{a',d'}$ over \F{p^n} for $p\neq 2$ is
defined by the equation \begin{equation}
  a'x^2+y^2=1+d'x^2y^2 \label{eq:twisted-edwards-curve} \end{equation}
for $a',d'\in\F{p^n}$~\cite{DBLP:journals/iacr/BernsteinBJLP08}.
%
A twisted Edwards curve is a quadratic twist of an Edwards curve by
$a_0=1/(a'-d')$.
%
For $P=(x,y)\in tE_{a',d'}$, $-P=(-x,y)$.
%
Furthermore, the addition and doubling formulae for
$(x_3,y_3)=(x_1,y_1)+(x_2,y_2)$ are given as follows.
%
\begin{itemize}
\item When $(x_1,y_1)\neq(x_2,y_2)$:
  \begin{align*}
    x_3 & = \frac{x_1y_2 + y_1x_2}{1 + d'x_1x_2y_1y_2} \\
    y_3 & = \frac{y_1y_2 - a'x_1x_2}{1 - d'x_1x_2y_1y_2}
  \end{align*}
\item When $(x_1,y_1)=(x_2,y_2)$:
  \begin{align*}
    x_3 & = \frac{2x_1y_1}{1 + d'x_1^2y_1^2} \\
    y_3 & = \frac{y_1^2 - a'x_1^2}{1 - d'x_1^2y_1^2}
  \end{align*}
\end{itemize}
%
As given by Faug\`ere, Gaudry, Hout, and
Renault~\cite{DBLP:journals/joc/FaugereGHR14}, the 3rd summation
polynomial for twisted Edwards curve is
%
\begin{align*}
  f_{tE, 3}(Y_1,Y_2,Y_3) = & \left(Y_1^2Y_2^2 - Y_1^2 - Y_2^2 + \frac{a}{d}\right)Y_3^2  + 2\frac{d-a}{d}Y_1Y_2Y_3 +
                             \frac{a}{d}\left(Y_1^2 + Y_2^2 - 1\right)
                             - Y_1^2Y_2^2.
\end{align*}
%
As usual, subsequent summation polynomials can be obtained by using
resultants.



\subsection{Symmetry and decomposition probability}
\label{sec:symmetry-decomposition-probability}

Symmetry brought by group action on point decomposition will
inevitably be accompanied by \emph{decrease in decomposition
  probability}.
%
For example, if a factor base $\mathcal F$ is invariant under the
addition of a 2-torsion point, then the decomposition probability
should further decrease by a factor of $2^{n-1}$, as is the case in
the earlier example of this section.
%
This is similar to that the decomposition probability decreases by a
factor of $n!$ due to the symmetry of the symmetric group $S_n$ acting
on $\mathcal F$.

However, such a simple fact seems to have been largely ignored in the
literature.
%
For example, Faug\`ere, Gaudry, Hout, and Renault explicitly stated in
Section~5.3 of their paper that ``[the] probability to decompose a
point [into a sum of $n$ points from the factor base] is
$\frac{1}{n!}$'' for twisted Edwards or twisted Jacobi intersections
curves, despite the fact that the factor base is invariant under
addition of 2-torsion points~\cite{DBLP:journals/joc/FaugereGHR14}.
%
At a first glance, this may not seem a problem, as we would expect to
obtain $2^{n-1}$ solutions if we can successfully solve a PDP
instance.
%
(Unfortunately this is also \emph{not true} in general.  We will come
back to it in more detail in Section~\ref{sec:experiment}.)
% 
However, when estimating the cost of a complete ECDLP attack, they
also proposed to \emph{collapse} these $2^{n-1}$ relations into one in
order to reduce the size of the factor base and hence the linear
algebra cost, cf.~Remark 5 of the paper.
%
In this case, the decrease in decomposition probability \emph{does}
have an adverse effect, and thus their estimation for the overall
ECDLP cost ended up being overoptimistic at least by a factor of
$2^{n-1}$.

To stay focused and make our discussion more manageable, we will not
dive into any further detail along this direction.
%
That is, we will restrict ourselves by considering only the
``standard'' factor bases (modulo negation) in the rest of this paper.

